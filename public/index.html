<!doctype html>
<html lang="hu">
<head>
<meta charset="utf-8">
<title>WhatsApp K√∂z√∂s N√©zet + V√°lasz</title>
<style>
body { font-family:sans-serif; background:#f4f4f4; }
.header { text-align:center; margin:10px auto; font-size:18px; color:#000; display:flex; justify-content:space-between; align-items:center; max-width:800px; }
.clock { color:#ffd106; font-weight:bold; }
.messages { max-width:800px; margin:0 auto 20px; padding:10px; background:#fff; border-radius:8px; height:60vh; overflow:auto; }
.msg { margin:10px 0; padding:8px 12px; background:#eef; border-radius:6px; position:relative; }
.meta { font-size:12px; color:#666; margin-bottom:4px; }
.reply-btn, .del-btn { margin-left:5px; font-size:11px; padding:2px 6px; cursor:pointer; }
form { max-width:800px; margin:10px auto; display:flex; gap:10px; }
input[type=text] { flex:1; padding:8px; border-radius:6px; border:1px solid #ccc; }
button { padding:8px 14px; border:none; border-radius:6px; background:#4caf50; color:#fff; font-weight:bold; cursor:pointer; }
.media { max-width:100%; margin-top:8px; border-radius:6px; }
.emoji-row { display:flex; flex-wrap:wrap; gap:5px; max-width:800px; margin:10px auto; }
.emoji-btn { cursor:pointer; font-size:20px; border:none; background:none; }
#qr { text-align:center; margin-bottom:10px; }
</style>
</head>
<body>
<div class="header">
    <div>WhatsApp ‚Äì K√∂z√∂s n√©zet √©s v√°lasz</div>
    <div class="clock" id="clock">--:--:--</div>
</div>

<div id="qr"></div>
<div class="messages" id="messages"></div>

<form id="chatForm">
<input type="hidden" id="target" value="">
<input type="text" id="reply" placeholder="√çrd ide az √ºzenetet..." required />
<button type="submit">K√ºld√©s</button>
</form>

<div class="emoji-row" id="emojiContainer"></div>

<script src="/socket.io/socket.io.js"></script>
<script>
const messagesEl = document.getElementById('messages');
const targetInput = document.getElementById('target');
const replyInput = document.getElementById('reply');
const emojiContainer = document.getElementById('emojiContainer');
const qrDiv = document.getElementById('qr');

const socket = io();

socket.on("qr", qr => {
    qrDiv.innerHTML = `<img src="https://api.qrserver.com/v1/create-qr-code/?data=${qr}&size=200x200" />`;
});

socket.on("ready", () => {
    qrDiv.innerHTML = "<b>Bejelentkezve!</b>";
});

function updateClock() {
    const now = new Date();
    document.getElementById('clock').textContent =
        String(now.getHours()).padStart(2,'0')+':'+
        String(now.getMinutes()).padStart(2,'0')+':'+
        String(now.getSeconds()).padStart(2,'0');
}
setInterval(updateClock,1000);
updateClock();

function addMessage(msg) {
    const wrap = document.createElement('div'); wrap.className='msg'; wrap.dataset.from=msg.from;
    const meta = document.createElement('div'); meta.className='meta';
    meta.textContent = (msg.name||msg.from)+' @ '+new Date(msg.t).toLocaleString();

    const replyBtn = document.createElement('button'); replyBtn.textContent='V√°lasz'; replyBtn.className='reply-btn';
    replyBtn.onclick=()=>targetInput.value=msg.from; meta.appendChild(replyBtn);

    const delBtn = document.createElement('button'); delBtn.textContent='T√∂rl√©s'; delBtn.className='del-btn';
    delBtn.onclick=()=>wrap.remove(); meta.appendChild(delBtn);

    wrap.appendChild(meta);

    if(msg.text) wrap.appendChild(document.createTextNode(msg.text));
    if(msg.media && msg.media.data){
        const img = document.createElement('img');
        img.src="data:"+msg.media.mimetype+";base64,"+msg.media.data;
        img.className="media";
        wrap.appendChild(img);
    }

    messagesEl.appendChild(wrap);
    messagesEl.scrollTop=messagesEl.scrollHeight;
}

socket.on("message", msg => addMessage(msg));
socket.on("history", history => history.forEach(addMessage));

document.getElementById('chatForm').addEventListener('submit', e=>{
    e.preventDefault();
    const text=replyInput.value.trim();
    const to=targetInput.value;
    if(!text||!to){ alert('V√°laszd ki, kinek k√ºld√∂d!'); return; }
    socket.emit("sendMessage",{to,text});
    replyInput.value='';
});

const emojiCategories={"Smileys":["üòÄ","üòÉ","üòÑ","üòÅ","üòÜ","üòÖ","üòÇ","ü§£","ü•≤","‚ò∫Ô∏è","üòä","üòá","üôÇ","üôÉ","üòâ","üòç","ü•∞","üòò"],
"Hearts":["‚ù§Ô∏è","üíî","üíñ","üíô","üíö","üíõ","üíú","üñ§"],
"Gestures":["üëç","üëé","üëå","‚úåÔ∏è","ü§û","ü§ü","ü§ò","üëè","üôè"]};

for(const cat in emojiCategories)
    emojiCategories[cat].forEach(e=>{
        const btn=document.createElement('button'); btn.textContent=e; btn.className='emoji-btn';
        btn.onclick=()=>replyInput.value=e; emojiContainer.appendChild(btn);
    });
</script>
</body>
</html>
